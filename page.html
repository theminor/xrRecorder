<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>xr18</title>
	<style>
		body { font-family: Arial, Helvetica, sans-serif; }
		h1 { color: maroon; }
		h2 {
			color: DarkSlateGray;
			margin: 40px 0px 0px;
			font-size: 20px;
		}
		div {
			width: 400px;
			padding-left: 30px;
		}
		#status {
			font-family: "Courier New", Courier, monospace;
			font-size: 20px;
		}
		#statusTable {
			font-size: 14px;
			padding-bottom: 20px;
		}
		#startStopBtn {
			background-color: ForestGreen;
			color: white;
			font-size: 20px;
			height: 70px;
			width: 130px;
			border-radius: 35%;
			margin-bottom: 20px;
			display: block;
		}
		.redFont { color: DarkRed; }
		.blueFont { color: DarkBlue; }
	</style>
	<script>
		const skt = new WebSocket(window.location.href.replace('http://', 'ws://').replace('https://', 'wss://'));
		let msg = {};
		function $(sel) { return document.getElementById(sel); }
		function getStatus() { skt.send('getStatus'); }
		skt.onmessage = function(event) {
			const st = $('status');
			const bt = $('startStopBtn');
			const stt = $('statusTxt');
			msg = JSON.parse(event.data);
			if (typeof msg === 'string') msg = JSON.parse(msg);   // prevent "over-stringified" string data
			if (msg.isRecording) {
				st.innerText = '[Recording]';
				st.className = 'redFont';
				stt.innerText = msg.recStats + msg.recStatus;   // *** TO DO: parse recStatus text and format it nicer
				bt.innerHTML = 'Stop';
				bt.style.backgroundColor = 'DarkRed';
			} else {
				st.innerText = '[Stopped]';
				st.className = 'blueFont';
				stt.innerText = '';
				bt.innerHTML = 'Record';
				bt.style.backgroundColor = 'ForestGreen';
			}
			if (msg.files) {
				const tbl = $('filesTable');
				tbl.innerHTML = '';
				for (let i = 0; i < msg.files.length; i++) {
					tbl.innerHTML += `<tr id="${msg.files[i]} onmouseover="getDetails('${msg.files[i]'})"><td><a href="${msg.files[i]}" download>${msg.files[i]}</a></td><td class="redFont" onclick="delFile('${msg.files[i]}')">[Delete]</td></tr>`;
				}
			}
			if (msg.fileDetail) {
				$(msg.fileDetail.fileName).title = msg.fileDetail.data;
			}
		}
		function startStopBtnClick() {
			if (msg.isRecording) { if (confirm('Stop Recording?')) skt.send('stopRecording'); }
			else skt.send($('numChannels').value);  // to start recording, just send the number of channels to record on
		}
		function delFile(fileName) { if (confirm(`Delete the file ${fileName}?`)) skt.send('DELETE:' + fileName); }
		function shutdownBtnClick() { if (confirm('Shutdown the system?')) skt.send('shutdown'); }
		function restartBtnClick() { if (confirm('Reboot the system?')) skt.send('reboot'); }
		function getDetails(fileName) { skt.send(fileName); }
		skt.onopen = event => {
			getStatus();
			skt.statusTimer = setInterval(getStatus, 5000);
		}
		skt.onclose = event => clearInterval(skt.statusTimer);
	</script>
</head>
<body class="blueFont">
	<h1>xr18</h1>
	<div>
		<h3 id="status">[Stopped]</h3>
		<p id="statusTxt"></p>
		<button id="startStopBtn" onclick="startStopBtnClick()">Record</button>
		<label for="numChannels">Channels: </label><select id="numChannels"></select>
		<script>for (let i = 1; i <= 18; i++) {	$('numChannels').innerHTML += `<option value=${i}>${i}</option>`; $('numChannels').value = 18; }</script>
	</div>
	<h2>Files:</h2>
	<div>
		<table id="filesTable"></table>
	</div>
	<h2>System:</h2>
	<div>
		<p onclick="shutdownBtnClick()">Shutdown</p>
		<p onclick="restartBtnClick()">Restart</p>
	</div>
</body>
</html>
